<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Jaskirat's Ultimate European Roulette</title>
<style>
/* ---------------------- THEME & LAYOUT ---------------------- */
:root{
  --bg-top:#052619;
  --bg-bottom:#02140b;
  --felt:#0f5e3d;
  --panel:#043d2e;
  --gold:#ffd166;
  --muted:#b8d6c6;
  --white:#ffffff;
  --glass: rgba(255,255,255,0.03);
  --danger:#ff6b6b;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  min-height:100vh;
  font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;
  color:var(--white);
  background:linear-gradient(180deg,var(--bg-top),var(--bg-bottom));
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}

/* header */
header{padding:18px;text-align:center}
h1{margin:0;font-size:20px;color:var(--gold);text-shadow:0 2px 10px rgba(0,0,0,.6)}

/* page layout */
.container{
  display:flex;
  gap:20px;
  align-items:flex-start;
  justify-content:center;
  padding:18px;
  flex-wrap:wrap;
}

/* wheel column */
.wheel-column{
  width:460px;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:14px;
}

/* wheel shell */
.wheel-wrap{position:relative;width:420px;height:420px}
svg#wheel{width:100%;height:100%;display:block;border-radius:999px;background:#0a0a0a;border:10px solid rgba(255,255,255,0.04);box-shadow:inset 0 10px 40px rgba(0,0,0,.6)}
#wheelGroup{transform-origin:50% 50%}
.pointer{position:absolute;left:50%;top:-28px;transform:translateX(-50%);width:0;height:0;border-left:18px solid transparent;border-right:18px solid transparent;border-bottom:36px solid var(--gold);z-index:40;filter:drop-shadow(0 12px 12px rgba(0,0,0,.6))}
.ball{
  position:absolute;width:18px;height:18px;border-radius:50%;
  background:linear-gradient(180deg,#fff,#f0f0f0);
  border:2px solid #ddd;box-shadow:0 6px 18px rgba(0,0,0,.6);z-index:45;
  transform-origin:center center;
}

/* small center plate */
.center-plate{
  position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
  width:56px;height:56px;border-radius:999px;background:#f7f7f7;border:4px solid #ddd;z-index:30;
  display:flex;align-items:center;justify-content:center;color:#333;font-weight:800;
}

/* panel column */
.panel{
  min-width:360px;
  max-width:740px;
  background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border-radius:12px;padding:12px;border:1px solid rgba(255,255,255,0.04);
  box-shadow:0 10px 40px rgba(0,0,0,.4);
}
.top-stats{display:flex;justify-content:space-between;align-items:center;gap:10px}
.top-stats .big{font-weight:900;font-size:18px}
.small{color:var(--muted);font-size:13px}

/* table grid (casino style) */
.table-grid{display:grid;grid-template-columns:100px repeat(3,64px) 120px;gap:6px;margin-top:12px;align-items:stretch}
.cell{background:var(--felt);border-radius:8px;padding:6px;display:flex;align-items:center;justify-content:center;font-weight:800;position:relative;cursor:pointer;border:1px solid rgba(0,0,0,.35);min-height:46px;color:#fff}
.cell.zero{background:#0b8a50;grid-row:span 12;font-size:18px;display:flex;align-items:center;justify-content:center}
.cell.red{background:#b71c27}
.cell.black{background:#0b0b0b}
.cell.outside{background:#103c2b}
.cell.column{background:#214f39}
.chip-badge{position:absolute;right:6px;bottom:6px;background:var(--gold);color:#111;padding:4px 6px;border-radius:20px;font-weight:900;font-size:13px;box-shadow:0 3px 0 rgba(0,0,0,.35)}
.cell-label{font-size:12px;color:#fff}

/* controls + chips */
.denoms{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:8px}
.denom{background:var(--gold);color:#111;border:none;padding:8px 12px;border-radius:999px;font-weight:800;cursor:pointer}
.denom.active{outline:3px solid rgba(255,255,255,.12)}
.controls{display:flex;gap:8px;justify-content:center;margin-top:12px}
.btn{background:var(--gold);color:#111;padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:800}
.btn.secondary{background:#b3e5c9}
.btn.warn{background:var(--danger)}
.input{padding:8px;border-radius:8px;border:none;width:120px}

/* overlay & modal */
.overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.65);z-index:500}
.overlay.hidden{display:none}
.modal{background:#fff;color:#111;padding:16px;border-radius:12px;width:min(96%,720px);text-align:left}
.modal h3{margin:0 0 8px}
.modal p{margin:6px 0}

/* confetti canvas */
canvas.confetti{position:fixed;left:0;top:0;pointer-events:none;z-index:520}

/* sad overlay */
.sad-shade{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;z-index:480}

/* footer small debug */
.footer{margin-top:8px;text-align:center;color:var(--muted);font-size:13px}

/* responsive tweaks */
@media (max-width:1100px){ .container{flex-direction:column;align-items:center} .wheel-column{width:100%}}
</style>
</head>
<body>
<header>
  <h1>Jaskirat's Ultimate European Roulette — Single Zero</h1>
</header>

<div class="container">
  <!-- WHEEL COLUMN -->
  <div class="wheel-column">
    <div class="wheel-wrap">
      <div class="pointer" title="Pointer"></div>
      <svg id="wheel" viewBox="0 0 360 360" role="img" aria-label="Roulette wheel">
        <g id="wheelGroup"></g>
        <circle cx="180" cy="180" r="30" fill="#f3f3f3"></circle>
      </svg>
      <div id="ball" class="ball" style="left:202px; top:18px"></div>
      <div class="center-plate">J</div>
    </div>
    <div style="display:flex;gap:10px;align-items:center;justify-content:center;width:100%;margin-top:8px">
      <div class="small">Wheel rotates clockwise. Ball runs anticlockwise and bounces on rim.</div>
    </div>
  </div>

  <!-- PANEL COLUMN -->
  <div class="panel">
    <div class="top-stats">
      <div class="big">Balance: $<span id="balance">1000</span></div>
      <div class="small">Pending: $<span id="pending">0</span></div>
    </div>

    <!-- betting table (0 column + 3 columns grid + outside bets) -->
    <div class="table-grid" id="tableGrid"></div>

    <div style="margin-top:10px" class="small">Click a chip to choose amount, then click a spot to place a bet. Same spot stacks. Clear refunds.</div>

    <!-- chip picker -->
    <div class="denoms" id="denoms"></div>
    <div style="display:flex;gap:8px;align-items:center;justify-content:center;margin-top:8px">
      <input id="customChip" class="input" type="number" min="1" placeholder="Custom $" />
      <button class="denom" id="setCustom">Set</button>
    </div>

    <div class="controls">
      <button class="btn" id="spinBtn">Spin (15s)</button>
      <button class="btn secondary" id="clearBtn">Clear (refund)</button>
      <button class="btn warn" id="resetBtn">Reset Balance</button>
    </div>

    <div style="display:flex;gap:12px;justify-content:center;align-items:center;margin-top:12px">
      <div class="small">Last: <b id="last">—</b></div>
      <div class="small">History: <span id="hist">—</span></div>
    </div>

    <div class="footer">Tip: If audio doesn't play, click a chip or "Start Game" to enable sound in your browser.</div>
  </div>
</div>

<!-- INTRO / RULES OVERLAY (shown on load) -->
<div class="overlay" id="introOverlay">
  <div class="modal">
    <h3>Welcome to Jaskirat's Roulette</h3>
    <p><strong>How to play (quick)</strong></p>
    <ul>
      <li>Choose a chip ($1/$5/$25/$100 or custom) — then click a number or outside bet to place a chip. Chips stack visually.</li>
      <li>Outside bets: <em>Red/Black</em>, <em>Even/Odd</em>, <em>1st 12 / 2nd 12 / 3rd 12</em>, <em>1–18 / 19–36</em>, <em>Column bets</em>.</li>
      <li>Payouts: Straight (single number) = 35:1 (return 36×), Dozens/Columns = 2:1 (return 3×), Color/Even/Odd/High-Low = 1:1 (return 2×).</li>
      <li>Press <strong>Spin</strong> when ready. Wheel spins ~15s; ball spins opposite and bounces until it lands in a pocket.</li>
    </ul>
    <div style="text-align:center;margin-top:10px"><button class="btn" id="startGameBtn">Start Game</button></div>
  </div>
</div>

<!-- RESULT OVERLAY -->
<div class="overlay hidden" id="resultOverlay">
  <div class="modal">
    <h3 id="resultTitle">Result</h3>
    <div id="resultBody"></div>
    <div style="text-align:center;margin-top:12px"><button class="btn" id="resultOkBtn">OK</button></div>
  </div>
</div>

<div class="sad-shade" id="sadShade"></div>
<canvas class="confetti" id="confettiCanvas"></canvas>

<!-- SOUNDS (public hosted samples) -->
<audio id="soundWheel" src="https://actions.google.com/sounds/v1/transportation/train_whistle.ogg" preload="auto"></audio>
<audio id="soundTick" src="https://actions.google.com/sounds/v1/foley/wood_block_hit.ogg" preload="auto"></audio>
<audio id="soundChip" src="https://actions.google.com/sounds/v1/foley/coin_drop.ogg" preload="auto"></audio>
<audio id="soundWin" src="https://actions.google.com/sounds/v1/alarms/bugle_tune.ogg" preload="auto"></audio>
<audio id="soundLose" src="https://actions.google.com/sounds/v1/human_voices/boo.ogg" preload="auto"></audio>
<audio id="soundCash" src="https://actions.google.com/sounds/v1/foley/wood_click.ogg" preload="auto"></audio>

<script>
/* =========================
   Jaskirat's Roulette JS
   ========================= */

/* ---------------- DATA ---------------- */
const wheelNumbers = [0,32,15,19,4,21,2,25,17,34,6,27,13,36,11,30,8,23,10,5,24,16,33,1,20,14,31,9,22,18,29,7,28,12,35,3,26];
const N = wheelNumbers.length; // 37
const redSet = new Set([1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36]);
const arcDeg = 360 / N;

let balance = 1000;
let pending = 0;
let currentChip = 25;
let bets = new Map(); // key -> {type,value,amount,cellEl}
let history = [];

let currentWheelRotation = 0; // degrees
let currentBallAngle = -90;   // degrees: -90 is top
let spinning = false;
let gameStarted = false;

/* ---------------- ELEMENTS ---------------- */
const wheelGroup = document.getElementById('wheelGroup');
const wheelEl = document.getElementById('wheel');
const ballEl = document.getElementById('ball');
const tableGrid = document.getElementById('tableGrid');
const denomsEl = document.getElementById('denoms');
const balanceEl = document.getElementById('balance');
const pendingEl = document.getElementById('pending');
const spinBtn = document.getElementById('spinBtn');
const clearBtn = document.getElementById('clearBtn');
const resetBtn = document.getElementById('resetBtn');
const lastEl = document.getElementById('last');
const histEl = document.getElementById('hist');

const introOverlay = document.getElementById('introOverlay');
const startGameBtn = document.getElementById('startGameBtn');
const resultOverlay = document.getElementById('resultOverlay');
const resultTitle = document.getElementById('resultTitle');
const resultBody = document.getElementById('resultBody');
const resultOkBtn = document.getElementById('resultOkBtn');

const sadShade = document.getElementById('sadShade');
const confettiCanvas = document.getElementById('confettiCanvas');
const confettiCtx = confettiCanvas.getContext('2d');

const soundWheel = document.getElementById('soundWheel');
const soundTick = document.getElementById('soundTick');
const soundChip = document.getElementById('soundChip');
const soundWin = document.getElementById('soundWin');
const soundLose = document.getElementById('soundLose');
const soundCash = document.getElementById('soundCash');

/* ---------------- HELPERS ---------------- */
function fmt(n){ return Number(n).toLocaleString('en-US'); }
function updateUI(){ balanceEl.textContent = fmt(balance); pendingEl.textContent = fmt(pending); }
function colorOf(n){ return n===0? 'green' : (redSet.has(n) ? 'red' : 'black'); }
function keyFor(type,value){ if(type==='number') return `N-${value}`; if(type==='color') return `C-${value}`; if(type==='evenodd') return `EO-${value}`; if(type==='dozen') return `D-${value}`; if(type==='column') return `COL-${value}`; return `${type}-${value}`; }

/* ---------------- BUILD WHEEL (SVG slices + numbers) ---------------- */
(function buildWheel(){
  const cx=180, cy=180, rOuter=170, rInner=100, rText=134;
  const start = -Math.PI/2;
  function polar(r,a){ return [cx + r*Math.cos(a), cy + r*Math.sin(a)]; }
  for(let i=0;i<N;i++){
    const a0 = start + i*(2*Math.PI/N);
    const a1 = a0 + (2*Math.PI/N);
    const aMid = (a0 + a1)/2;
    const num = wheelNumbers[i];
    const fill = (num===0) ? '#0b8a50' : (redSet.has(num) ? '#b71c27' : '#0b0b0b');

    const [ix0,iy0] = polar(rInner,a0);
    const [ox0,oy0] = polar(rOuter,a0);
    const [ox1,oy1] = polar(rOuter,a1);
    const [ix1,iy1] = polar(rInner,a1);
    const d = [`M ${ix0} ${iy0}`, `L ${ox0} ${oy0}`, `A ${rOuter} ${rOuter} 0 0 1 ${ox1} ${oy1}`, `L ${ix1} ${iy1}`, `A ${rInner} ${rInner} 0 0 0 ${ix0} ${iy0}`, 'Z'].join(' ');
    const path = document.createElementNS('http://www.w3.org/2000/svg','path');
    path.setAttribute('d', d);
    path.setAttribute('fill', fill);
    path.setAttribute('stroke', '#333');
    path.setAttribute('data-index', i);
    wheelGroup.appendChild(path);

    const [tx,ty] = polar(rText,aMid);
    const text = document.createElementNS('http://www.w3.org/2000/svg','text');
    text.setAttribute('x', tx);
    text.setAttribute('y', ty);
    text.setAttribute('text-anchor','middle');
    text.setAttribute('dominant-baseline','middle');
    text.setAttribute('font-size','12');
    text.setAttribute('font-weight','800');
    text.setAttribute('fill', '#fff');
    text.textContent = num;
    wheelGroup.appendChild(text);
  }
})();

/* ---------------- BUILD BETTING TABLE (0 column + 3x12 + dozens + outside bets + columns) ---------------- */
(function buildTable(){
  // zero tall cell
  const zero = document.createElement('div');
  zero.className = 'cell zero number';
  zero.textContent = '0';
  zero.dataset.key = 'N-0';
  zero.addEventListener('click', ()=>placeBet('number',0,zero));
  tableGrid.appendChild(zero);

  // create 12 rows of 3 columns each (casino layout)
  for(let row=0; row<12; row++){
    for(let col=0; col<3; col++){
      const num = row*3 + (3-col);
      const div = document.createElement('div');
      div.className = 'cell number ' + (redSet.has(num)? 'red' : 'black');
      div.textContent = num;
      div.dataset.key = `N-${num}`;
      div.addEventListener('click', ()=>placeBet('number', num, div));
      tableGrid.appendChild(div);
    }
  }

  // dozens row (1st 12, 2nd 12, 3rd 12)
  const dozens = [{label:'1st 12',v:1},{label:'2nd 12',v:2},{label:'3rd 12',v:3}];
  dozens.forEach(d=>{
    const el = document.createElement('div');
    el.className = 'cell outside';
    el.textContent = d.label;
    el.dataset.key = `D-${d.v}`;
    el.addEventListener('click', ()=>placeBet('dozen', d.v, el));
    tableGrid.appendChild(el);
  });

  // column bets (2:1) — column 1 (numbers 3,6,...), column 2 (2,5,8,...), column 3 (1,4,7,...)
  const col1 = document.createElement('div'); col1.className='cell column'; col1.textContent='COL 3'; col1.dataset.key='COL-3'; col1.addEventListener('click',()=>placeBet('column',3,col1)); tableGrid.appendChild(col1);
  const col2 = document.createElement('div'); col2.className='cell column'; col2.textContent='COL 2'; col2.dataset.key='COL-2'; col2.addEventListener('click',()=>placeBet('column',2,col2)); tableGrid.appendChild(col2);
  const col3 = document.createElement('div'); col3.className='cell column'; col3.textContent='COL 1'; col3.dataset.key='COL-1'; col3.addEventListener('click',()=>placeBet('column',1,col3)); tableGrid.appendChild(col3);

  // even/odd and red/black and high/low
  const outs = [
    {label:'EVEN', v:'even', type:'evenodd'},
    {label:'ODD', v:'odd', type:'evenodd'},
    {label:'RED', v:'red', type:'color'},
    {label:'BLACK', v:'black', type:'color'},
    {label:'1-18', v:'low', type:'range'},
    {label:'19-36', v:'high', type:'range'}
  ];
  outs.forEach(o=>{
    const el = document.createElement('div');
    el.className = 'cell outside ' + (o.v==='red'?'red':o.v==='black'?'black':'');
    el.textContent = o.label;
    el.dataset.key = (o.type==='evenodd' ? `EO-${o.v}` : o.type==='color' ? `C-${o.v}` : `R-${o.v}`);
    el.addEventListener('click', ()=>placeBet(o.type==='evenodd' ? 'evenodd' : o.type==='color' ? 'color' : 'range', o.v, el));
    tableGrid.appendChild(el);
  });
})();

/* ---------------- CHIP PICKER ---------------- */
(function buildDenoms(){
  const denoms = [1,5,25,100];
  denoms.forEach(d=>{
    const btn = document.createElement('button');
    btn.className = 'denom' + (d===currentChip? ' active':'');
    btn.textContent = '$' + d;
    btn.dataset.value = d;
    btn.addEventListener('click', ()=>{
      document.querySelectorAll('.denom').forEach(x=>x.classList.remove('active'));
      btn.classList.add('active');
      currentChip = d;
      // allow audio unlocking
      try{ soundChip.play().catch(()=>{}); }catch(e){}
    });
    denomsEl.appendChild(btn);
  });
  document.getElementById('setCustom').addEventListener('click', ()=>{
    const v = Math.max(1, parseInt(document.getElementById('customChip').value||0));
    if(!v) return;
    document.querySelectorAll('.denom').forEach(x=>x.classList.remove('active'));
    currentChip = v;
  });
})();

/* ---------------- PLACE BETS (stacking & badge) ---------------- */
function ensureBadge(cellEl, amount){
  let badge = cellEl.querySelector('.chip-badge');
  if(!badge){
    badge = document.createElement('div');
    badge.className = 'chip-badge';
    cellEl.appendChild(badge);
  }
  badge.textContent = '$' + fmt(amount);
  return badge;
}

function placeBet(type, value, cellEl){
  if(!gameStarted){ openIntro(); return; }
  if(spinning) return;
  const key = keyFor(type, value);
  const amt = Number(currentChip);
  if(balance < amt){ openResult('Not enough balance','Lower chip or reset balance.'); return; }

  // deduct and update pending
  balance -= amt;
  pending += amt;
  updateUI();

  if(bets.has(key)) bets.get(key).amount += amt;
  else bets.set(key, {type, value, amount: amt, cellEl});

  ensureBadge(cellEl, bets.get(key).amount);

  try{ soundChip.currentTime = 0; soundChip.play().catch(()=>{}); }catch(e){}
}

/* ---------------- CLEAR & RESET ---------------- */
document.getElementById('clearBtn').addEventListener('click', ()=>{
  if(spinning) return;
  if(bets.size === 0) return;
  let refund = 0;
  for(const [k,b] of bets){ refund += b.amount; if(b.cellEl){ const badge = b.cellEl.querySelector('.chip-badge'); if(badge) badge.remove(); } }
  balance += refund;
  pending = 0;
  bets.clear();
  updateUI();
  try{ soundCash.currentTime = 0; soundCash.play().catch(()=>{}); }catch(e){}
});

document.getElementById('resetBtn').addEventListener('click', ()=>{
  if(spinning) return;
  for(const [k,b] of bets){ if(b.cellEl){ const badge = b.cellEl.querySelector('.chip-badge'); if(badge) badge.remove(); } }
  bets.clear();
  balance = 1000; pending = 0;
  updateUI();
  lastEl.textContent = '—'; histEl.textContent = '—';
});

/* ---------------- SPIN (wheel clockwise, ball anticlockwise, 15s) ---------------- */
spinBtn.addEventListener('click', ()=>{ if(!gameStarted){ openIntro(); return; } startSpin(); });

function startSpin(){
  if(spinning) return;
  if(bets.size === 0){ openResult('No bets','Place at least one bet before spinning.'); return; }

  spinning = true;
  spinBtn.disabled = true;
  clearBtn.disabled = true;

  // choose winning index
  const winIdx = Math.floor(Math.random()*N);
  const winNumber = wheelNumbers[winIdx];

  // wheel target: rotate so that (wheelRotation + (winIdx+0.5)*arcDeg) === -90
  const extraSpins = 6 + Math.floor(Math.random()*3); // 6..8
  const pocketAlign = - ( (winIdx + 0.5) * arcDeg );
  const targetWheel = extraSpins*360 + pocketAlign; // positive = clockwise
  const startWheel = currentWheelRotation;

  // ball - anticlockwise
  const ballSpins = 10 + Math.floor(Math.random()*6);
  const targetBall = - (ballSpins*360) - ((winIdx + 0.5) * arcD
  const startBall = currentBallAngle;

  const duration = 15000;
  const startTime = performance.now();

  clearSliceHighlights();

  // sound while spinning - play ticks and wheel hum intermittently
  const tickInterval = setInterval(()=>{ try{ soundTick.currentTime = 0; soundTick.play().catch(()=>{}); }catch(e){} }, 750);
  try{ soundWheel.currentTime = 0; soundWheel.play().catch(()=>{}); soundWheel.loop = true; }catch(e){}

  function frame(now){
    const t = Math.min(1, (now - startTime) / duration);
    const eased = easeOutQuad(t);

    // wheel rotates cw
    const wheelAngle = startWheel + (targetWheel - startWheel) * eased;
    wheelGroup.style.transform = `rotate(${wheelAngle}deg)`;
    currentWheelRotation = wheelAngle;

    // ball anticlockwise
    const ballAngle = startBall + (targetBall - startBall) * eased;
    currentBallAngle = ballAngle;

    // radial position + bounce (damps over time)
    const bbox = wheelEl.getBoundingClientRect();
    const cx = bbox.width/2;
    const cy = bbox.height/2;
    const outerR = bbox.width/2 - 18;
    const innerR = bbox.width/2 - 48;
    const baseRadius = innerR + (outerR - innerR) * (0.9 + 0.1 * (1 - eased));
    const bounceAmp = Math.max(1.5, 14 * (1 - eased));
    const wobble = Math.sin((now - startTime)/120) * bounceAmp;
    const finalRadius = baseRadius + wobble;

    const rad = (ballAngle - 90) * Math.PI/180;
    const bx = cx + finalRadius * Math.cos(rad) - (ballEl.offsetWidth/2);
    const by = cy + finalRadius * Math.sin(rad) - (ballEl.offsetHeight/2);
    ballEl.style.left = bx + 'px';
    ballEl.style.top = by + 'px';

    if(t < 1) requestAnimationFrame(frame);
    else {
      clearInterval(tickInterval);
      try{ soundWheel.pause(); soundWheel.currentTime = 0; }catch(e){}
      // highlight final slice
      highlightSlice(winIdx);

      // settle bets
      const {winnings, detail} = settle(winNumber);
      pending = 0;
      balance += winnings;
      updateUI();

      history.unshift(`${winNumber}`);
      if(history.length>10) history.length = 10;
      lastEl.textContent = `${winNumber} (${colorOf(winNumber)})`;
      histEl.textContent = history.join(', ');

      // win / lose UI
      if(winnings > 0){
        try{ soundWin.currentTime = 0; soundWin.play().catch(()=>{}); }catch(e){}
        launchConfetti();
        openResult(`You Won $${fmt(winnings)}!`, `Number: ${winNumber}<br>${detail}`);
      } else {
        try{ soundLose.currentTime = 0; soundLose.play().catch(()=>{}); }catch(e){}
        sadShade.style.display = 'block';
        setTimeout(()=> sadShade.style.display = 'none', 1400);
        openResult('You Lost', `Winning number: ${winNumber}`);
      }
            // cleanup badges
      for(const [k,b] of bets){ if(b.cellEl){ const badge = b.cellEl.querySelector('.chip-badge'); if(badge) badge.remove(); } }
      bets.clear();

      spinning = false;
      spinBtn.disabled = false;
      clearBtn.disabled = false;
    }
  }

  requestAnimationFrame(frame);
}

/* easing */
function easeOutQuad(x){ return 1 - (1 - x) * (1 - x); }

/* ---------------- Payout / rules ---------------- */
function inDozen(n,d){ if(d===1) return n>=1 && n<=12; if(d===2) return n>=13 && n<=24; if(d===3) return n>=25 && n<=36; return false; }
function inColumn(n,c){
  // column1: numbers 1,4,7,... (c===1), column2: 2,5,8,... (c===2), column3:3,6,9,... (c===3)
  if(n===0) return false;
  const mod = n % 3;
  if(c===1) return mod === 1;
  if(c===2) return mod === 2;
  if(c===3) return mod === 0;
  return false;
}

function settle(winNum){
  let total = 0;
  const lines = [];
  for(const [k,b] of bets){
    let pay = 0;
    if(b.type === 'number'){
      if(b.value === winNum) pay = b.amount * 36;
    } else if(b.type === 'color'){
      if(winNum !== 0 && b.value === colorOf(winNum)) pay = b.amount * 2;
    } else if(b.type === 'evenodd'){
      if(winNum !== 0){
        if(b.value === 'even' && winNum % 2 === 0) pay = b.amount * 2;
        if(b.value === 'odd' && winNum % 2 === 1) pay = b.amount * 2;
      }
    } else if(b.type === 'dozen'){
      if(inDozen(winNum, b.value)) pay = b.amount * 3;
    } else if(b.type === 'range'){
      if(b.value === 'low' && winNum>=1 && winNum<=18) pay = b.amount * 2;
      if(b.value === 'high' && winNum>=19 && winNum<=36) pay = b.amount * 2;
    } else if(b.type === 'column'){
      if(inColumn(winNum, b.value)) pay = b.amount * 3;
    }
    if(pay > 0){
      lines.push(`${labelFor(b)} → $${fmt(pay)}`);
      total += pay;
    }
  }
  if(lines.length === 0) lines.push('No winning bets');
  return {winnings: total, detail: lines.join('<br>')};
}
function labelFor(b){
  if(b.type === 'number') return `#${b.value}`;
  if(b.type === 'color') return b.value.toUpperCase();
  if(b.type === 'evenodd') return b.value.toUpperCase();
  if(b.type === 'dozen') return b.value===1 ? '1st 12' : b.value===2 ? '2nd 12' : '3rd 12';
  if(b.type === 'range') return b.value==='low' ? '1-18' : '19-36';
  if(b.type === 'column') return `COL ${b.value}`;
  return '';
}

/* ---------------- SLICE HIGHLIGHT ---------------- */
function clearSliceHighlights(){
  const paths = wheelGroup.querySelectorAll('path');
  paths.forEach(p => p.classList.remove('slice-highlight'));
}
function highlightSlice(index){
  clearSliceHighlights();
  const paths = wheelGroup.querySelectorAll('path');
  const p = paths[index];
  if(p) p.classList.add('slice-highlight');
}

/* ---------------- CONFETTI (canvas) ---------------- */
function launchConfetti(){
  const w = confettiCanvas.width = window.innerWidth;
  const h = confettiCanvas.height = window.innerHeight;
  const pieces = [];
  const colors = ['#ffd166','#ff6b6b','#6bd3ff','#9bede2','#ffe66d','#bdecb6'];
  for(let i=0;i<120;i++){
    pieces.push({
      x: Math.random()*w,
      y: Math.random()*-h,
      vx: (Math.random()-0.5)*2,
      vy: 2 + Math.random()*4,
      r: 6 + Math.random()*8,
      c: colors[Math.floor(Math.random()*colors.length)],
      rot: Math.random()*360,
      vr: (Math.random()-0.5)*8
    });
  }
  let t0 = performance.now();
  function step(now){
    const dt = Math.min(50, now - t0); t0 = now;
    confettiCtx.clearRect(0,0,w,h);
    for(const p of pieces){
      p.x += p.vx * (dt/16);
      p.y += p.vy * (dt/16);
      p.rot += p.vr * (dt/16);
      confettiCtx.save();
      confettiCtx.translate(p.x,p.y);
      confettiCtx.rotate(p.rot * Math.PI/180);
      confettiCtx.fillStyle = p.c;
      confettiCtx.fillRect(-p.r/2, -p.r/2, p.r, p.r);
      confettiCtx.restore();
    }
    // continue until last piece off-screen
    if(pieces[pieces.length-1].y < h + 200){
      requestAnimationFrame(step);
    } else {
      setTimeout(()=> confettiCtx.clearRect(0,0,w,h), 600);
    }
  }
  requestAnimationFrame(step);
}

/* ---------------- MODALS ---------------- */
function openIntro(){ introOverlay.style.display = 'flex'; }
function closeIntro(){ introOverlay.style.display = 'none'; gameStarted = true; }
startGameBtn.addEventListener('click', ()=>{ closeIntro(); try{ soundTick.play().catch(()=>{}); }catch(e){} });

function openResult(title, body){ resultTitle.textContent = title; resultBody.innerHTML = body; resultOverlay.classList.remove('hidden'); resultOverlay.style.display = 'flex'; }
function closeResult(){ resultOverlay.style.display = 'none'; resultOverlay.classList.add('hidden'); }
resultOkBtn.addEventListener('click', ()=> closeResult());

/* ---------------- INIT UI ---------------- */
updateUI();
openIntro();

/* expose for debugging */
window.roulette = { bets, placeBet, startSpin };

/* ---------------- NOTE about autoplay: browser policies require user interaction to enable audio. Interact with chips or Start Game to enable sounds. ---------------- */
</script>
</body>
</html>
