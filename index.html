<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Jaskirat — European Roulette (Base)</title>
<style>
:root{
  --wheel-size:420px;
  --felt:#0f5e3d;
  --panel:#043d2e;
  --gold:#ffd166;
  --muted:#b8d6c6;
}
*{box-sizing:border-box}
body{margin:0;background:linear-gradient(180deg,#04271a,#02150d);font-family:Inter,system-ui,Arial;color:#fff}
header{padding:14px;text-align:center}
h1{margin:0;color:var(--gold);text-shadow:0 2px 6px #000}
.wrap{display:flex;gap:18px;align-items:flex-start;justify-content:center;padding:12px;flex-wrap:wrap}
/* wheel */
.wheel-wrap{position:relative;width:var(--wheel-size)}
svg#wheel{width:var(--wheel-size);height:var(--wheel-size);display:block;border-radius:50%;background:#111;border:8px solid rgba(255,255,255,.04);box-shadow:0 8px 40px rgba(0,0,0,.5) inset}
#wheelGroup{transform-origin:50% 50%}
.pointer{position:absolute;left:50%;top:-20px;transform:translateX(-50%);width:0;height:0;border-left:14px solid transparent;border-right:14px solid transparent;border-bottom:28px solid var(--gold);z-index:6;filter:drop-shadow(0 6px 8px rgba(0,0,0,.6))}
.ball-placeholder{display:none} /* no ball in this base */
.slice-highlight{fill:rgba(255,255,255,0.12)}

/* panel / table */
.panel{min-width:360px;max-width:520px;background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.01));padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.04)}
.top-stats{display:flex;justify-content:space-between;gap:10px;align-items:center}
.top-stats .big{font-weight:900;font-size:18px}
.table-grid{display:grid;grid-template-columns:80px repeat(3,64px);gap:6px;margin-top:10px}
.cell{background:var(--felt);border-radius:8px;padding:6px;display:flex;align-items:center;justify-content:center;font-weight:800;position:relative;cursor:pointer;border:1px solid rgba(0,0,0,.35);min-height:46px}
.cell.zero{background:#0b8a50;color:#fff;grid-row:span 12;font-size:18px;display:flex;align-items:center;justify-content:center}
.cell.red{background:#b71c27}
.cell.black{background:#0b0b0b}
.cell.outside{background:#103c2b}
.chip-badge{position:absolute;right:6px;bottom:6px;background:var(--gold);color:#111;padding:2px 6px;border-radius:999px;font-weight:900;font-size:12px;box-shadow:0 3px 0 rgba(0,0,0,.35)}
.denoms{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:8px}
.denom{background:var(--gold);color:#111;border:none;padding:8px 12px;border-radius:999px;font-weight:800;cursor:pointer}
.denom.active{outline:3px solid rgba(255,255,255,.12)}
.controls{display:flex;gap:8px;justify-content:center;margin-top:10px}
.btn{background:var(--gold);color:#111;padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:800}
.btn.secondary{background:#b3e5c9}
.small{color:var(--muted);font-size:13px}

/* popup & effects */
.overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.6);z-index:200}
.modal{background:#fff;color:#111;padding:18px;border-radius:12px;width:min(92%,420px);text-align:center}
.modal h3{margin:0 0 8px}
.sad-shade{position:fixed;inset:0;background:rgba(0,0,0,.3);display:none;z-index:150}
canvas.confetti{position:fixed;left:0;top:0;pointer-events:none;z-index:210}

/* responsive */
@media (max-width:880px){ .wrap{flex-direction:column;align-items:center} .panel{width:100%} svg#wheel{width:320px;height:320px} }
</style>
</head>
<body>
<header><h1>Jaskirat's Roulette — European (0)</h1></header>

<div class="wrap">
  <div class="wheel-wrap">
    <div class="pointer" title="Pointer"></div>
    <svg id="wheel" viewBox="0 0 360 360" role="img" aria-label="Roulette wheel">
      <g id="wheelGroup"></g>
      <circle cx="180" cy="180" r="26" fill="#f3f3f3"></circle>
      <circle cx="180" cy="180" r="8" fill="#666"></circle>
    </svg>
  </div>

  <div class="panel">
    <div class="top-stats">
      <div class="big">Balance: $<span id="balance">1000</span></div>
      <div class="small">Pending: $<span id="pending">0</span></div>
    </div>

    <div class="table-grid" id="tableGrid"></div>

    <div style="margin-top:8px" class="small">Click a chip, then click a spot to place a bet. Click same spot again to stack.</div>

    <div class="denoms" id="denoms"></div>
    <div style="display:flex;gap:8px;align-items:center;justify-content:center;margin-top:8px">
      <input id="customChip" type="number" min="1" placeholder="Custom $" style="padding:8px;border-radius:8px;border:none;width:120px">
      <button class="denom" id="setCustom">Set</button>
    </div>

    <div class="controls">
      <button class="btn" id="spinBtn">Spin (15s)</button>
      <button class="btn secondary" id="clearBtn">Clear (refund)</button>
      <button class="btn" id="resetBtn">Reset Balance</button>
    </div>

    <div style="margin-top:10px;display:flex;gap:12px;justify-content:center;align-items:center">
      <div class="small">Last: <b id="last">—</b></div>
      <div class="small">History: <span id="hist">—</span></div>
    </div>
  </div>
</div>

<div class="overlay" id="overlay"><div class="modal"><h3 id="modalTitle"></h3><div id="modalBody"></div><div style="margin-top:12px"><button class="btn" onclick="closeModal()">OK</button></div></div></div>
<div class="sad-shade" id="sadShade"></div>
<canvas class="confetti" id="confettiCanvas"></canvas>

<!-- simple sounds (hosted) -->
<audio id="soundChip" src="https://actions.google.com/sounds/v1/foley/coin_drop.ogg" preload="auto"></audio>
<audio id="soundWin" src="https://actions.google.com/sounds/v1/alarms/bugle_tune.ogg" preload="auto"></audio>
<audio id="soundLose" src="https://actions.google.com/sounds/v1/human_voices/boo.ogg" preload="auto"></audio>
<audio id="soundCash" src="https://actions.google.com/sounds/v1/foley/wood_block_hit.ogg" preload="auto"></audio>

<script>
/* ---------------- DATA ---------------- */
const wheelNumbers = [0,32,15,19,4,21,2,25,17,34,6,27,13,36,11,30,8,23,10,5,24,16,33,1,20,14,31,9,22,18,29,7,28,12,35,3,26];
const N = wheelNumbers.length; // 37
const redSet = new Set([1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36]);
const arcDeg = 360 / N;

let balance = 1000;
let pending = 0;
let currentChip = 25;
let bets = new Map(); // key -> {type,value,amount,cellEl}
let history = [];

let currentWheelRotation = 0; // degrees
let spinning = false;

/* element refs */
const wheelGroup = document.getElementById('wheelGroup');
const wheelEl = document.getElementById('wheel');
const tableGrid = document.getElementById('tableGrid');
const denomsEl = document.getElementById('denoms');
const balanceEl = document.getElementById('balance');
const pendingEl = document.getElementById('pending');
const spinBtn = document.getElementById('spinBtn');
const clearBtn = document.getElementById('clearBtn');
const resetBtn = document.getElementById('resetBtn');
const lastEl = document.getElementById('last');
const histEl = document.getElementById('hist');
const overlay = document.getElementById('overlay');
const modalTitle = document.getElementById('modalTitle');
const modalBody = document.getElementById('modalBody');
const sadShade = document.getElementById('sadShade');

const soundChip = document.getElementById('soundChip');
const soundWin = document.getElementById('soundWin');
const soundLose = document.getElementById('soundLose');
const soundCash = document.getElementById('soundCash');

const confettiCanvas = document.getElementById('confettiCanvas');
const confettiCtx = confettiCanvas.getContext('2d');

/* ---------------- HELPERS ---------------- */
function fmt(n){ return Number(n).toLocaleString('en-US'); }
function updateUI(){ balanceEl.textContent = fmt(balance); pendingEl.textContent = fmt(pending); }
function colorOf(n){ return n===0 ? 'green' : (redSet.has(n) ? 'red' : 'black'); }
function keyFor(type,value){ if(type==='number') return `N-${value}`; if(type==='color') return `C-${value}`; if(type==='evenodd') return `EO-${value}`; if(type==='dozen') return `D-${value}`; return `${type}-${value}`; }

/* ---------------- BUILD WHEEL ---------------- */
(function buildWheel(){
  const cx=180, cy=180, rOuter=170, rInner=100, rText=132;
  const start = -Math.PI/2;
  function polar(r,a){ return [cx + r*Math.cos(a), cy + r*Math.sin(a)]; }

  for(let i=0;i<N;i++){
    const a0 = start + i*(2*Math.PI/N);
    const a1 = a0 + (2*Math.PI/N);
    const aMid = (a0 + a1)/2;
    const num = wheelNumbers[i];
    const fill = (num===0) ? '#0b8a50' : (redSet.has(num) ? '#b71c27' : '#0b0b0b');

    const [ix0,iy0] = polar(rInner,a0);
    const [ox0,oy0] = polar(rOuter,a0);
    const [ox1,oy1] = polar(rOuter,a1);
    const [ix1,iy1] = polar(rInner,a1);
    const d = [`M ${ix0} ${iy0}`, `L ${ox0} ${oy0}`, `A ${rOuter} ${rOuter} 0 0 1 ${ox1} ${oy1}`, `L ${ix1} ${iy1}`, `A ${rInner} ${rInner} 0 0 0 ${ix0} ${iy0}`, 'Z'].join(' ');

    const path = document.createElementNS('http://www.w3.org/2000/svg','path');
    path.setAttribute('d', d);
    path.setAttribute('fill', fill);
    path.setAttribute('stroke', '#333');
    path.setAttribute('data-index', i);
    wheelGroup.appendChild(path);

    const [tx,ty] = polar(rText,aMid);
    const text = document.createElementNS('http://www.w3.org/2000/svg','text');
    text.setAttribute('x', tx);
    text.setAttribute('y', ty);
    text.setAttribute('text-anchor','middle');
    text.setAttribute('dominant-baseline','middle');
    text.setAttribute('font-size','12');
    text.setAttribute('font-weight','800');
    text.setAttribute('fill', '#fff');
    text.textContent = num;
    wheelGroup.appendChild(text);
  }
})();

/* ---------------- BUILD TABLE GRID ---------------- */
(function buildTable(){
  const zero = document.createElement('div');
  zero.className = 'cell zero number';
  zero.textContent = '0';
  zero.dataset.key = 'N-0';
  zero.addEventListener('click', ()=>placeBet('number',0,zero));
  tableGrid.appendChild(zero);

  for(let row=0; row<12; row++){
    for(let col=0; col<3; col++){
      const num = row*3 + (3-col);
      const div = document.createElement('div');
      div.className = 'cell number ' + (redSet.has(num) ? 'red' : 'black');
      div.textContent = num;
      div.dataset.key = `N-${num}`;
      div.addEventListener('click', ()=>placeBet('number',num,div));
      tableGrid.appendChild(div);
    }
  }

  const dozens = [{label:'1st 12', v:1},{label:'2nd 12', v:2},{label:'3rd 12', v:3}];
  dozens.forEach(d=>{
    const el = document.createElement('div');
    el.className = 'cell outside';
    el.textContent = d.label;
    el.dataset.key = `D-${d.v}`;
    el.addEventListener('click', ()=>placeBet('dozen', d.v, el));
    tableGrid.appendChild(el);
  });

  const outs = [{label:'EVEN',v:'even'},{label:'ODD',v:'odd'},{label:'RED',v:'red'},{label:'BLACK',v:'black'}];
  outs.forEach(o=>{
    const el = document.createElement('div');
    el.className = 'cell outside ' + (o.v==='red'?'red':o.v==='black'?'black':'');
    el.textContent = o.label;
    el.dataset.key = (o.v==='even'||o.v==='odd') ? `EO-${o.v}` : `C-${o.v}`;
    el.addEventListener('click', ()=>placeBet(o.v==='even'||o.v==='odd' ? 'evenodd' : 'color', o.v, el));
    tableGrid.appendChild(el);
  });
})();

/* ---------------- CHIP PICKER ---------------- */
(function buildDenoms(){
  const denoms = [1,5,25,100];
  denoms.forEach(d=>{
    const btn = document.createElement('button');
    btn.className = 'denom' + (d===currentChip ? ' active':'');
    btn.textContent = '$' + d;
    btn.dataset.value = d;
    btn.addEventListener('click', ()=>{
      document.querySelectorAll('.denom').forEach(x=>x.classList.remove('active'));
      btn.classList.add('active');
      currentChip = d;
    });
    denomsEl.appendChild(btn);
  });
  document.getElementById('setCustom').addEventListener('click', ()=>{
    const v = Math.max(1, parseInt(document.getElementById('customChip').value||0));
    if(!v) return;
    document.querySelectorAll('.denom').forEach(x=>x.classList.remove('active'));
    currentChip = v;
  });
})();

/* ---------------- PLACE BETS ---------------- */
function ensureBadge(cellEl, amount){
  let badge = cellEl.querySelector('.chip-badge');
  if(!badge){
    badge = document.createElement('div');
    badge.className = 'chip-badge';
    cellEl.appendChild(badge);
  }
  badge.textContent = '$' + fmt(amount);
  return badge;
}

function placeBet(type, value, cellEl){
  if(spinning) return;
  const key = keyFor(type, value);
  const amt = Number(currentChip);
  if(balance < amt){ openModal('Not enough balance','Lower your chip or reset balance.'); return; }
  balance -= amt;
  pending += amt;
  updateUI();
  if(bets.has(key)){
    bets.get(key).amount += amt;
  } else {
    bets.set(key, {type, value, amount: amt, cellEl});
  }
  ensureBadge(cellEl, bets.get(key).amount);
  try{ soundChip.currentTime = 0; soundChip.play().catch(()=>{}); }catch(e){}
}

/* ---------------- CLEAR / RESET ---------------- */
clearBtn.addEventListener('click', ()=>{
  if(bets.size === 0) return;
  let refund = 0;
  for(const [k,b] of bets){ refund += b.amount; if(b.cellEl){ const badge = b.cellEl.querySelector('.chip-badge'); if(badge) badge.remove(); } }
  balance += refund;
  pending = 0;
  bets.clear();
  updateUI();
  try{ soundCash.currentTime = 0; soundCash.play().catch(()=>{}); }catch(e){}
});
resetBtn.addEventListener('click', ()=>{
  for(const [k,b] of bets){ if(b.cellEl){ const badge = b.cellEl.querySelector('.chip-badge'); if(badge) badge.remove(); } }
  bets.clear();
  balance = 1000; pending = 0; updateUI();
  lastEl.textContent = '—'; histEl.textContent = '—';
});

/* ---------------- SPIN (15s) ---------------- */
spinBtn.addEventListener('click', startSpin);

function startSpin(){
  if(spinning) return;
  if(bets.size === 0){ openModal('No bets', 'Place at least one bet before spinning.'); return; }

  spinning = true;
  spinBtn.disabled = true;
  clearBtn.disabled = true;

  const winIdx = Math.floor(Math.random()*N);
  const winNumber = wheelNumbers[winIdx];

  const extraSpins = 6 + Math.floor(Math.random()*3); // 6..8
  // angle of pocket center with no rotation: aMid_deg = -90 + (winIdx+0.5)*arcDeg
  // want final rotation such that aMid_deg + rotation = -90  => rotation = -90 - aMid_deg = -(winIdx+0.5)*arcDeg
  const pocketAlign = - ( (winIdx + 0.5) * arcDeg );
  const targetWheel = extraSpins*360 + pocketAlign; // positive rotates clockwise
  const startWheel = currentWheelRotation;
  const duration = 15000;
  const startTime = performance.now();

  clearSliceHighlights();

  // optional periodic sound could be added here (skipped to keep base stable)

  function frame(now){
    const t = Math.min(1, (now - startTime) / duration);
    const eased = easeOutCubic(t);
    const wheelAngle = startWheel + (targetWheel - startWheel) * eased;
    wheelGroup.style.transform = `rotate(${wheelAngle}deg)`;
    currentWheelRotation = wheelAngle;

    if(t < 1) requestAnimationFrame(frame);
    else {
      // finalize
      highlightSlice(winIdx);
      const {winnings, detail} = settle(winNumber);
      pending = 0;
      balance += winnings;
      updateUI();

      history.unshift(`${winNumber}`);
      if(history.length>10) history.length = 10;
      lastEl.textContent = `${winNumber} (${colorOf(winNumber)})`;
      histEl.textContent = history.join(', ');

      if(winnings > 0){
        try{ soundWin.currentTime = 0; soundWin.play().catch(()=>{}); }catch(e){}
        launchConfetti();
        openModal(`You Won $${fmt(winnings)}!`, `Number: ${winNumber}<br>${detail}`);
      } else {
        try{ soundLose.currentTime = 0; soundLose.play().catch(()=>{}); }catch(e){}
        sadShade.style.display = 'block';
        setTimeout(()=> sadShade.style.display = 'none', 1400);
        openModal('You Lost', `Winning number: ${winNumber}`);
      }

      for(const [k,b] of bets){ if(b.cellEl){ const badge = b.cellEl.querySelector('.chip-badge'); if(badge) badge.remove(); } }
      bets.clear();

      spinning = false;
      spinBtn.disabled = false;
      clearBtn.disabled = false;
    }
  }
  requestAnimationFrame(frame);
}

function easeOutCubic(x){ return 1 - Math.pow(1 - x, 3); }
function clearSliceHighlights(){
  const paths = wheelGroup.querySelectorAll('path');
  paths.forEach(p => p.classList.remove('slice-highlight'));
}
function highlightSlice(index){
  clearSliceHighlights();
  const paths = wheelGroup.querySelectorAll('path');
  const p = paths[index];
  if(p) p.classList.add('slice-highlight');
}

/* ---------------- PAYOUTS ---------------- */
function inDozen(n,d){ if(d===1) return n>=1 && n<=12; if(d===2) return n>=13 && n<=24; if(d===3) return n>=25 && n<=36; return false; }

function settle(winNum){
  let total = 0;
  const lines = [];
  for(const [k,b] of bets){
    let pay = 0;
    if(b.type === 'number'){
      if(b.value === winNum) pay = b.amount * 36;
    } else if(b.type === 'color'){
      if(winNum !== 0 && b.value === colorOf(winNum)) pay = b.amount * 2;
    } else if(b.type === 'evenodd'){
      if(winNum !== 0){
        if(b.value === 'even' && winNum % 2 === 0) pay = b.amount * 2;
        if(b.value === 'odd' && winNum % 2 === 1) pay = b.amount * 2;
      }
    } else if(b.type === 'dozen'){
      if(inDozen(winNum, b.value)) pay = b.amount * 3;
    }
    if(pay > 0){
      lines.push(`${labelFor(b)} → $${fmt(pay)}`);
      total += pay;
    }
  }
  if(lines.length === 0) lines.push('No winning bets');
  return {winnings: total, detail: lines.join('<br>')};
}
function labelFor(b){ if(b.type === 'number') return `#${b.value}`; if(b.type === 'color') return b.value.toUpperCase(); if(b.type === 'evenodd') return b.value.toUpperCase(); if(b.type === 'dozen') return b.value===1 ? '1st 12' : b.value===2 ? '2nd 12' : '3rd 12'; return ''; }

/* ---------------- UI EFFECTS: confetti, modal ---------------- */
function launchConfetti(){
  const w = confettiCanvas.width = window.innerWidth;
  const h = confettiCanvas.height = window.innerHeight;
  const pieces = [];
  const colors = ['#ffd166','#ff6b6b','#6bcBff','#9bede2','#ffe66d','#bdecb6'];
  for(let i=0;i<80;i++){
    pieces.push({
      x: Math.random()*w,
      y: Math.random()*-h,
      vx: (Math.random()-0.5)*2,
      vy: 2 + Math.random()*4,
      r: 6 + Math.random()*8,
      c: colors[Math.floor(Math.random()*colors.length)],
      rot: Math.random()*360,
      vr: (Math.random()-0.5)*8
    });
  }
  let t0 = performance.now();
  function step(now){
    const dt = Math.min(50, now - t0); t0 = now;
    confettiCtx.clearRect(0,0,w,h);
    for(const p of pieces){
      p.x += p.vx * (dt/16);
      p.y += p.vy * (dt/16);
      p.rot += p.vr * (dt/16);
      confettiCtx.save();
      confettiCtx.translate(p.x,p.y);
      confettiCtx.rotate(p.rot * Math.PI/180);
      confettiCtx.fillStyle = p.c;
      confettiCtx.fillRect(-p.r/2, -p.r/2, p.r, p.r);
      confettiCtx.restore();
    }
    if(pieces[pieces.length-1].y < h + 100){
      requestAnimationFrame(step);
    } else {
      setTimeout(()=> confettiCtx.clearRect(0,0,w,h), 600);
    }
  }
  requestAnimationFrame(step);
}
function openModal(title, body){ modalTitle.textContent = title; modalBody.innerHTML = body; overlay.style.display = 'flex'; }
function closeModal(){ overlay.style.display = 'none'; }

/* ---------------- Place bet wrapper used in table building ---------------- */
function placeBet(type, value, cellEl){
  if(spinning) return;
  const key = keyFor(type, value);
  const amt = Number(currentChip);
  if(balance < amt){ openModal('Not enough balance', 'Lower chip or reset balance.'); return; }
  balance -= amt;
  pending += amt;
  updateUI();
  if(bets.has(key)) bets.get(key).amount += amt;
  else bets.set(key, {type, value, amount: amt, cellEl});
  ensureBadge(cellEl, bets.get(key).amount);
  try{ soundChip.currentTime = 0; soundChip.play().catch(()=>{}); }catch(e){}
}

/* init UI */
updateUI();
window.roulette = { bets, placeBet, startSpin
